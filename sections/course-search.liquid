<style>
  .result-item {
    margin-bottom: 10px;
  }
  .result-item .name {
    font-weight: bold;
  }
</style>

<div class="section-{{ section.id }}-padding gradient color-{{ section.settings.section_color_scheme }}">
  <div class="page-width">
    <h1>{{ section.settings.title }}</h1>
    <div>{{ section.settings.description }}</div>
    <input type="text" id="searchInput" placeholder="Course name">
    <div id="results"></div>
  </div>
</div>

<script type="text/javascript">
  document.getElementById('searchInput').addEventListener(
    'input',
    debounce(function (event) {
      const searchTerm = event.target.value;
      if (searchTerm) {
        fetchResults(searchTerm);
      } else {
        clearResults();
      }
    }, 300),
  );

  function fetchResults(query) {
    if (query.length < 5) {
      return;
    }
    // Replace 'your-api-endpoint' with the actual endpoint
    fetch(`https://pinned-golf-app.fly.dev/search/courses.json?course_name=${query}`)
      .then((response) => response.json())
      .then((data) => displayResults(data))
      .catch((error) => console.error('Error fetching data:', error));
  }

  function displayResults(results) {
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = ''; // Clear previous results

    results.forEach((item) => {
      const resultItem = document.createElement('div');
      resultItem.classList.add('result-item');

      const nameElement = document.createElement('div');
      nameElement.classList.add('name');
      nameElement.textContent = item.name;

      const locationElement = document.createElement('div');
      locationElement.textContent = `${item.city}, ${item.state}`;

      resultItem.appendChild(nameElement);
      resultItem.appendChild(locationElement);
      resultsContainer.appendChild(resultItem);
    });
  }

  function clearResults() {
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = ''; // Clear previous results
  }

  function debounce(func, wait) {
    let timeout;
    return function (...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }
</script>

{% schema %}
{
  "name": "Course Search",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "Search For a Course",
      "label": "Title"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.options__2.label"
        },
        {
          "value": "h0",
          "label": "t:sections.all.heading_size.options__3.label"
        }
      ],
      "default": "h1",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    }
  ],
  "presets": [
    {
      "name": "Course Search"
    }
  ]
}
{% endschema %}
